---
title: "Homework 05: Factor and figure management"
author: "Stephen Chignell"
date: "October 19, 2018"
output:
  github_document:
    toc: yes
---

## Overview

**Goals:**

- Reorder a factor in a principled way based on the data and demonstrate the effect in arranged data and in figures.
- Write some data to file and load it back into R.
- Improve a figure (or make one from scratch), using new knowledge, e.g., control the color scheme, use factor levels, smoother mechanics.
- Make a plotly visual.
- Implement visualization design principles.


## Part 1: Factor management

**Overview of factors**

Factors are “truly categorical” variables. They are vectors that:

- have character entries on the surface (i.e. category/class name)
- have integers underneath (i.e. code for computer to keep track)
- have different levels (i.e., number of unique categories/classes)

We will use the gapminder dataset to explore working with factors in the following ways:

- Drop factor / levels
- Reorder levels based on knowledge from data


#### Load libraries

```{r libraries}
suppressPackageStartupMessages(library(tidyr))
suppressPackageStartupMessages(library(dplyr))
suppressPackageStartupMessages(library(ggplot2))
suppressPackageStartupMessages(library(knitr))
suppressPackageStartupMessages(library(forcats))
suppressPackageStartupMessages(library(gapminder))
```

#### Look at the data

```{r gap levels}
str(gapminder)
```

This confirms that we have two factors, `country` (142 levels), and `continent` (5 levels).


#### Drop Oceania

Suppose we wanted to remove observations in the continent of **Oceania** from the dataset. 

To start, we should review the names of the level using the `nlevels` function:

```{r level check}
levels(gapminder$continent)
```

Next we filter the data. We can remove unused levels at the same time by piping the filter results into the `droplevels()` function:

```{r remove Oceania}
gap_sans_OCE <- gapminder %>% 
  filter(continent != "Oceania") %>% 
  droplevels()
```

Now let's confirm there are no longer any "Oceania" rows:
```{r confirm}
NROW(gap_sans_OCE %>% 
  filter(continent == "Oceania"))
```

Looks good! We can also check how many rows were dropped:
```{r difference}
# Subtract to find difference
NROW(gapminder) - NROW(gap_sans_OCE)
```

We have now confirmed that all "Oceania" rows (n=24) have been removed from the original dataset. What about the levels?

```{r check levels}
levels(gap_sans_OCE$continent)
```

Great! We have successfully removed the unused levels.

#### Reorder the levels of `country` or `continent`


Suppose we wanted to plot mean life expectancy for each continent:


```{r mean_pop}
mean_pop <- gapminder %>%
  group_by(continent) %>% 
  summarize(mean.pop = mean(pop)) 
knitr::kable(mean_pop)
```

Let's plot the reordered data:
```{r plot mean_pop}
ggplot(mean_pop, aes(continent, mean.pop)) + 
  geom_point()
```

By default, the levels are ordered alphabetically, which does not help to highlight any patterns in the data. 

We can change these to ascending order using the `fct_reorder` function:

```{r mean_pop ordered}
mean_pop %>%
  mutate(continent = fct_reorder(continent, mean.pop)) %>% 
  ggplot(aes(continent, mean.pop)) + 
  geom_point()
```

## Part 2: File I/O

Let's practice exporting and importing data. Say we wanted to look at life expectancies in American countries with a population over 5,000,000 for the year 2007:

#### Filter and arrange data
```{r filter Americas pop}
America_pop_2007 <- gapminder %>%
  filter(continent == "Americas", year == 2007, pop > 5000000) %>%
  arrange(pop) # arrange in ascending order
```

Let's view it as a table:
```{r view pop table}
knitr::kable(America_pop_2007)
```

#### Write to .CSV
Let's practice exporting to a comma separated values (.csv) file:
```{r write csv}
# set row.names to FALSE to avoide creation of extra ID column
write.csv(America_pop_2007, file = "America_pop_2007_5M.csv", row.names = FALSE) 
```

We can see that the .csv was successfully exported to the project folder and the data are correct in Microsoft Excel. 

#### Re-import from .csv
```{r read csv}
America_pop_2007_READ <- read.csv("America_pop_2007_5M.csv")
knitr::kable(America_pop_2007_READ)
```
Great! The data are still arranged by intrecing population, so it surved the write-out/read-in process. 

**Note**: To write or read a .csv outside of the project folder, you need to enter in the full file path.








